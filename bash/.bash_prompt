#!/bin/bash

echo 'Running .bash_prompt'

# ---------------------------------------------------------------------------- 
#                                                     _
#                     _ __  _ __ ___  _ __ ___  _ __ | |_
#                    | '_ \| '__/ _ \| '_ ` _ \| '_ \| __|
#                    | |_) | | | (_) | | | | | | |_) | |_
#                    | .__/|_|  \___/|_| |_| |_| .__/ \__|
#                    |_|                       |_|
#
# ---------------------------------------------------------------------------- 
#  File: .bash_prompt
# ---------------------------------------------------------------------------- 
#  Modified: March 17, 2020
# ---------------------------------------------------------------------------- 
#  Author: Artyom Danilov
# ---------------------------------------------------------------------------- 

# ---------------------------------------------------------------------------- #
#                                    Colors                                    #
# ---------------------------------------------------------------------------- #

black='\[\033[0;30m\]'   ; bold_black='\[\033[1;30m\]'
blue='\[\033[0;34m\]'    ; bold_blue='\[\033[1;34m\]'
cyan='\[\033[0;36m\]'    ; bold_cyan='\[\033[1;36m\]'
green='\[\033[0;32m\]'   ; bold_green='\[\033[1;32m\]'
magenta='\[\033[0;35m\]' ; bold_magenta='\[\033[1;35m\]'
red='\[\033[0;31m\]'     ; bold_red='\[\033[1;31m\]'
white='\[\033[0;37m\]'   ; bold_white='\[\033[1;37m\]'
yellow='\[\033[0;33m\]'  ; bold_yellow='\[\033[1;33m\]'

reset='\[\033[00m\]'

# ---------------------------------------------------------------------------- #
#                                   Statuses                                   #
# ---------------------------------------------------------------------------- #

success="${bold_green}:)${reset}"
failure="${bold_red}:(${reset}"

# ---------------------------------------------------------------------------- #
#                                PROMPT_COMMAND                                #
# ---------------------------------------------------------------------------- #

# Gets executed each time bash prompt is shown.
PROMPT_COMMAND='                                                               \
                                                                               \
# Get last command status                                                      \
if [[ $? -eq 0 ]]; then                                                        \
    status="${success}";                                                       \
else                                                                           \
    status="${failure}";                                                       \
fi;                                                                            \
                                                                               \
# Get git branch                                                               \
if git status >/dev/null 2>&1; then                                            \
                                                                               \
    # Branch currently on.                                                     \
    branch="$(git branch 2>/dev/null | grep "^*" | colrm 1 2)";                \
                                                                               \
    # Number of commits in repository on branch.                               \
    commits="$(git rev-list --count ${branch})";                               \
                                                                               \
    # Colorize branch, sep, commits.                                           \
    branch="${bold_green}${branch}";                                           \
    sep="${bold_white}|";                                                      \
    commits="${bold_cyan}${commits}";                                          \
                                                                               \
    # on [ branch | commits ].                                                 \
    branch="${bold_white} on [ ${branch} ${sep} ${commits} ${bold_white}]";    \
                                                                               \
else                                                                           \
    branch="";                                                                 \
fi;                                                                            \
                                                                               \
# Set PS1                                                                      \
PS1="${bold_yellow}\u";                     # username                         \
PS1+="${bold_white}@${bold_yellow}\h";      # @host                            \
PS1+=" ${bold_white}in ${bold_yellow}\W";   # in directory                     \
PS1+="${branch}";                           # on [ branch ]                    \
PS1+=" ${status}";                          # :) or :(                         \
PS1+="${reset} \$ ";'

# Default
#PS1="$green\u@\h$reset:$blue\w$reset\$ "
